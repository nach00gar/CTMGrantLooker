name: Python application

on: push

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v3
      - name: Set up Python 3.10
        uses: actions/setup-python@v3
        with:
          python-version: "3.10"
      - name: Install Dependencies
        run: |
          pip install beautifulsoup4
          pip install requests
      - name: Run Scraper
        run: python advisor.py
      - name: Save Results to Repository
        run: |
          mkdir -p results
          mv results.txt results/
          git config --global user.email ${{ secrets.MAIL }}
          git config --global user.name "nach00gar"
          git add results/results.txt
          git commit -m "Actualizar resultados"
          git push
      - name: Send mail
        uses: dawidd6/action-send-mail@v3
        with:
          connection_url: smtp+starttls://${{secrets.MAIL_SENDER}}:${{secrets.MAIL_PASSWORD}}@smtp.gmail.com:465
          server_address: smtp.gmail.com
          server_port: 465
          secure: true
          username: ${{secrets.MAIL_SENDER}}
          password: ${{secrets.MAIL_PASSWORD}}
          subject: AVISO SEMANAL DE SUBVENCIONES
          to: ${{secrets.MAIL_CLUB}}
          from: Automatizado por GitHub
          body: $(cat results.txt)
          ignore_cert: true  # Quité la coma después de "true"

      - name: Eliminar archivo results.txt del repositorio
        run: rm results/results.txt
        continue-on-error: true
